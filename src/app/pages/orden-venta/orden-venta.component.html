<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Orden de Venta - TodoTech Shop</title>
  <link rel="stylesheet" href="orden-venta.component.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
</head>
<body>
  <div class="overlay"></div>
  
  <!-- Navbar -->
  <app-navbar-orden></app-navbar-orden>
  
  <!-- Contenido Principal -->
  <main class="orden-venta-container" id="ordenVentaContainer">
    
    <!-- Sección del Formulario -->
    <div class="orden-venta-form">
      <header class="form-header">
        <h1 class="orden-venta-title">
          <i class="fas fa-shopping-cart"></i>
          Orden de Venta
        </h1>
        <p class="orden-venta-subtitle">Registra una nueva venta para tu cliente</p>
      </header>

      <!-- Mensajes de estado -->
      <div class="messages-container">
        <!-- Mensaje de carga -->
        <div *ngIf="isLoading" class="message loading-message">
          <i class="fas fa-spinner fa-spin"></i>
          Creando cliente, por favor espere...
        </div>

        <!-- Mensaje de éxito -->
        <div *ngIf="successMessage && !isLoading" class="message success-message">
          <i class="fas fa-check-circle"></i>
          {{ successMessage }}
        </div>

        <!-- Mensaje de error -->
        <div *ngIf="errorMessage && !isLoading" class="message error-message">
          <i class="fas fa-exclamation-circle"></i>
          {{ errorMessage }}
        </div>
      </div>

      <!-- Formulario principal -->
      <form *ngIf="!clienteCreado" (ngSubmit)="onSubmit()" class="venta-form">
        
        <!-- Contenedor principal con dos columnas -->
        <div class="form-content-wrapper">
          
          <!-- Columna izquierda: Información del Cliente -->
          <div class="form-column-left">
            <!-- Información del Cliente -->
            <section class="form-section">
              <h3 class="section-title">Información del Cliente</h3>
              
              <div class="form-grid">
                <div class="input-group">
                  <input 
                    type="text" 
                    id="nombreCliente" 
                    name="nombreCliente" 
                    required 
                    [(ngModel)]="cliente.nombre"
                    minlength="2"
                    maxlength="150"
                    placeholder=" "
                    [disabled]="isLoading">
                  <label for="nombreCliente">Nombre del Cliente *</label>
                  <small class="input-hint">Entre 2 y 150 caracteres</small>
                </div>

                <div class="input-group">
                  <input 
                    type="text" 
                    id="cedulaCliente" 
                    name="cedulaCliente" 
                    required 
                    [(ngModel)]="cliente.cedula"
                    minlength="5"
                    maxlength="20"
                    placeholder=" "
                    [disabled]="isLoading">
                  <label for="cedulaCliente">Cédula *</label>
                  <small class="input-hint">Entre 5 y 20 caracteres (debe ser única)</small>
                </div>

                <div class="input-group">
                  <input 
                    type="email" 
                    id="correoCliente" 
                    name="correoCliente" 
                    [(ngModel)]="cliente.correo"
                    maxlength="100"
                    placeholder=" "
                    [disabled]="isLoading">
                  <label for="correoCliente">Correo Electrónico</label>
                </div>

                <div class="input-group">
                  <input 
                    type="tel" 
                    id="telefonoCliente" 
                    name="telefonoCliente" 
                    [(ngModel)]="cliente.telefono"
                    pattern="[+]?[0-9]{10,20}"
                    maxlength="20"
                    placeholder=" "
                    [disabled]="isLoading">
                  <label for="telefonoCliente">Teléfono</label>
                  <small class="input-hint">Formato: +1234567890 o 1234567890</small>
                </div>
              </div>

              <div class="input-group full-width">
                <textarea
                  id="direccionCliente" 
                  name="direccionCliente" 
                  [(ngModel)]="cliente.direccion"
                  maxlength="255"
                  placeholder=" "
                  rows="3"
                  [disabled]="isLoading"></textarea>
                <label for="direccionCliente">Dirección</label>
              </div>
            </section>
          </div>
          
          <!-- Columna derecha: Tipo de Cliente y Acciones -->
          <div class="form-column-right">
            <!-- Tipo de Cliente -->
            <section class="form-section">
              <h3 class="section-title">Tipo de Cliente</h3>
              
              <div class="radio-group">
                <div class="radio-option">
                  <input 
                    type="radio" 
                    id="tipoNatural" 
                    name="tipoCliente" 
                    value="NATURAL"
                    [(ngModel)]="cliente.tipoCliente"
                    required
                    [disabled]="isLoading">
                  <label for="tipoNatural">Persona Natural</label>
                  <span class="radio-description">(5% de descuento por defecto)</span>
                </div>
                
                <div class="radio-option">
                  <input 
                    type="radio" 
                    id="tipoJuridico" 
                    name="tipoCliente" 
                    value="JURIDICO"
                    [(ngModel)]="cliente.tipoCliente"
                    required
                    [disabled]="isLoading">
                  <label for="tipoJuridico">Persona Jurídica</label>
                  <span class="radio-description">(10% de descuento por defecto)</span>
                </div>
              </div>

              <div class="input-group">
                <input 
                  type="number" 
                  id="descuentoAplicable" 
                  name="descuentoAplicable" 
                  [(ngModel)]="cliente.descuentoAplicable"
                  placeholder=" "
                  min="0"
                  max="30"
                  step="0.1"
                  [disabled]="isLoading"
                  (blur)="validarDescuento()"
                  (input)="validarDescuento()"
                  [class.input-error]="descuentoError">
                <label for="descuentoAplicable">Descuento Personalizado (%)</label>
                <small class="input-hint">Opcional. Máximo 30%. Si se deja vacío, se aplicará el descuento por defecto según el tipo de cliente</small>
                
                <!-- Mensaje de error específico para descuento -->
                <div *ngIf="descuentoError" class="error-message-descuento">
                  <i class="fas fa-exclamation-triangle"></i>
                  <span class="error-text">{{ descuentoError }}</span>
                </div>
              </div>
            </section>

            <!-- Acciones del Formulario -->
            <section class="form-actions">
              <button type="button" class="btn-secondary" (click)="limpiarFormulario()" [disabled]="isLoading">
                <i class="fas fa-broom"></i>
                Limpiar
              </button>
              <button type="submit" class="btn-primary" [disabled]="isLoading || descuentoError">
                <i class="fas fa-save"></i>
                <span *ngIf="!isLoading">Registrar Cliente y Crear Orden</span>
                <span *ngIf="isLoading">Creando Cliente...</span>
              </button>
            </section>
          </div>
        </div>
      </form>

      <!-- Panel de confirmación cuando el cliente es creado -->
      <div *ngIf="clienteCreado" class="confirmation-panel">
        <div class="confirmation-header">
          <i class="fas fa-check-circle success-icon"></i>
          <h2 class="confirmation-title">¡Cliente Registrado Exitosamente!</h2>
          <p class="confirmation-subtitle">El cliente ha sido registrado correctamente. Ahora puedes continuar con la orden de venta.</p>
        </div>

        <div class="client-details-card">
          <h3 class="details-title">Datos del Cliente Registrado</h3>
          <div class="details-grid">
            <div class="detail-item">
              <span class="detail-label">Nombre:</span>
              <span class="detail-value">{{ clienteCreado.nombre }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Cédula:</span>
              <span class="detail-value">{{ clienteCreado.cedula }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Tipo de Cliente:</span>
              <span class="detail-value">{{ clienteCreado.tipoCliente === 'NATURAL' ? 'Persona Natural' : 'Persona Jurídica' }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Descuento Aplicable:</span>
              <span class="detail-value">{{ clienteCreado.descuentoAplicable }}%</span>
            </div>
            <div class="detail-item" *ngIf="clienteCreado.correo">
              <span class="detail-label">Correo:</span>
              <span class="detail-value">{{ clienteCreado.correo }}</span>
            </div>
            <div class="detail-item" *ngIf="clienteCreado.telefono">
              <span class="detail-label">Teléfono:</span>
              <span class="detail-value">{{ clienteCreado.telefono }}</span>
            </div>
            <div class="detail-item" *ngIf="clienteCreado.direccion">
              <span class="detail-label">Dirección:</span>
              <span class="detail-value">{{ clienteCreado.direccion }}</span>
            </div>
          </div>
        </div>

        <div class="confirmation-actions">
          <button type="button" class="btn-secondary" (click)="limpiarFormulario()">
            <i class="fas fa-user-plus"></i>
            Registrar Otro Cliente
          </button>
          <button type="button" class="btn-continue" (click)="continuarConOrden()">
            <i class="fas fa-arrow-right"></i>
            Continuar con Orden de Venta
          </button>
        </div>
      </div>
    </div>
  </main>
</body>
</html>