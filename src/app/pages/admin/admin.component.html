<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Panel - TodoTech</title>
  <link rel="stylesheet" href="admin.component.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
</head>
<body>

<div class="overlay"></div>

<header>
  <nav>
    <ul class="menu">
      <li><span class="logo">TodoTechAdmin</span></li>
      <li><a href="#" (click)="mostrarSeccion('usuarios'); $event.preventDefault()">Usuarios</a></li>
      <li><a href="#" (click)="mostrarSeccion('productos'); $event.preventDefault()">Productos</a></li>
      <li><a href="#" (click)="mostrarSeccion('ordenes'); $event.preventDefault()">Órdenes de Venta</a></li>
      <li><a href="#" (click)="mostrarSeccion('reportes'); $event.preventDefault()">Reportes</a></li>
      <li><a href="#" (click)="mostrarSeccion('inventario'); $event.preventDefault()">Inventario</a></li>
      <li><a href="#" (click)="mostrarSeccion('configuracion'); $event.preventDefault()">Configuración</a></li>
      <li><a href="#" class="logout" (click)="$event.preventDefault()">Salir</a></li>
    </ul>
  </nav>
</header>

<main>
  <section class="content">
    <div *ngIf="seccionActiva === 'bienvenida'" class="bienvenida-container">
  <div class="logo-animation">
    <div class="logo-wrapper">
      <img src="assets/TigreCircle.png" alt="Panel de administración" class="bienvenida-img" />
      <div class="wave-container">
        <div class="wave-circle"></div>
        <div class="wave-circle"></div>
        <div class="wave-circle"></div>
      </div>
      <div class="orbit-dots">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
      </div>
    </div>
  </div>
  
  <h1 class="bienvenida-title">¡Bienvenido al Panel de Administración!</h1>
  
  <p class="bienvenida-text">
    Desde aquí podrás gestionar <span class="highlight">usuarios</span>, <span class="highlight">productos</span>,
    <span class="highlight">reportes</span> e <span class="highlight">inventario</span>. Todo en un solo lugar,
    con una experiencia intuitiva и eficiente.
  </p>
</div>
 

    <div *ngIf="seccionActiva === 'usuarios'">
  <h2>Gestión de Usuarios</h2>
  
  <div class="form-container">
    <h3>{{ usuarioEditando ? 'Editar' : 'Crear' }} Usuario</h3>
    <form #formUsuario="ngForm" (ngSubmit)="guardarUsuario()">
      <div class="form-row">
        <div class="form-group">
          <label for="cedula">Cédula *</label>
          <input type="text" id="cedula" name="cedula" [(ngModel)]="usuario.cedula" 
                 #cedulaInput="ngModel"
                 placeholder="Número de cédula" required pattern="[0-9]{6,15}" 
                 title="La cédula debe contener solo números (6-15 dígitos)" />
          <div *ngIf="cedulaInput.invalid && (cedulaInput.dirty || cedulaInput.touched)" class="error-message">
            <div *ngIf="cedulaInput.errors?.['required']">La cédula es obligatoria</div>
            <div *ngIf="cedulaInput.errors?.['pattern']">Debe contener solo números (6-15 dígitos)</div>
          </div>
        </div>
        
        <div class="form-group">
          <label for="nombre">Nombre completo *</label>
          <input type="text" id="nombre" name="nombre" [(ngModel)]="usuario.nombre" 
                 #nombreInput="ngModel"
                 placeholder="Nombre completo" required />
          <div *ngIf="nombreInput.invalid && (nombreInput.dirty || nombreInput.touched)" class="error-message">
            El nombre es obligatorio
          </div>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label for="correo">Correo electrónico *</label>
          <input type="email" id="correo" name="correo" [(ngModel)]="usuario.correo" 
                 #correoInput="ngModel"
                 placeholder="Correo electrónico" required />
          <div *ngIf="correoInput.invalid && (correoInput.dirty || correoInput.touched)" class="error-message">
            <div *ngIf="correoInput.errors?.['required']">El correo es obligatorio</div>
            <div *ngIf="correoInput.errors?.['email']">Formato de correo inválido</div>
          </div>
        </div>
        
        <div class="form-group">
          <label for="telefono">Teléfono *</label>
          <input type="tel" id="telefono" name="telefono" [(ngModel)]="usuario.telefono" 
                 #telefonoInput="ngModel"
                 placeholder="Número de teléfono" required pattern="[0-9]{7,10}" 
                 title="El teléfono debe contener solo números (7-10 dígitos)" />
          <div *ngIf="telefonoInput.invalid && (telefonoInput.dirty || telefonoInput.touched)" class="error-message">
            <div *ngIf="telefonoInput.errors?.['required']">El teléfono es obligatorio</div>
            <div *ngIf="telefonoInput.errors?.['pattern']">Debe contener solo números (7-10 dígitos)</div>
          </div>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label for="nombreUsuario">Nombre de usuario *</label>
          <input type="text" id="nombreUsuario" name="nombreUsuario" [(ngModel)]="usuario.nombreUsuario" 
                 #nombreUsuarioInput="ngModel"
                 placeholder="Nombre de usuario" required />
          <div *ngIf="nombreUsuarioInput.invalid && (nombreUsuarioInput.dirty || nombreUsuarioInput.touched)" class="error-message">
            El nombre de usuario es obligatorio
          </div>
        </div>
        
        <div class="form-group">
          <label for="contrasena">Contraseña *</label>
          <input type="password" id="contrasena" name="contrasena" [(ngModel)]="usuario.contrasena" 
                 #contrasenaInput="ngModel"
                 placeholder="Contraseña" required minlength="6" />
          <div *ngIf="contrasenaInput.invalid && (contrasenaInput.dirty || contrasenaInput.touched)" class="error-message">
            <div *ngIf="contrasenaInput.errors?.['required']">La contraseña es obligatoria</div>
            <div *ngIf="contrasenaInput.errors?.['minlength']">Mínimo 6 caracteres</div>
          </div>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label for="tipoUsuario">Tipo de Usuario *</label>
          <select id="tipoUsuario" name="tipoUsuario" [(ngModel)]="usuario.tipoUsuario" 
                  #tipoUsuarioInput="ngModel" required>
            <option value="" disabled selected>Seleccione un tipo de usuario</option>
            <option value="ADMIN">ADMINISTRADOR</option>
            <option value="VENDEDOR">VENDEDOR</option>
            <option value="CAJERO">CAJERO</option>
            <option value="DESPACHADOR">DESPACHADOR</option>
          </select>
          <div *ngIf="tipoUsuarioInput.invalid && (tipoUsuarioInput.dirty || tipoUsuarioInput.touched)" class="error-message">
            El tipo de usuario es obligatorio
          </div>
        </div>
        
        <div class="form-group">
          <label for="estado">Estado *</label>
          <select id="estado" name="estado" [(ngModel)]="usuario.estado" 
                  #estadoInput="ngModel" required>
            <option [value]="true">Activo</option>
            <option [value]="false">Inactivo</option>
          </select>
          <div *ngIf="estadoInput.invalid && (estadoInput.dirty || estadoInput.touched)" class="error-message">
            El estado es obligatorio
          </div>
        </div>
      </div>
      
      <!-- GRUPO DE BOTONES CORREGIDO - SIN DESHABILITAR -->
      <div class="button-group">
        <button type="submit" [disabled]="formUsuario.invalid">
          {{ usuarioEditando ? 'Actualizar' : 'Guardar' }} Usuario
        </button>
        <button type="button" (click)="limpiarFormulario()">Limpiar</button>
        <button type="button" *ngIf="usuarioEditando" (click)="limpiarFormulario()" class="btn-cancelar">
          Cancelar Edición
        </button>
      </div>
    </form>
  </div>


  <div class="filtros-container">
  <h4>Filtros de Búsqueda</h4>
  
  <div class="filtros-row">
    <!-- Búsqueda por nombre -->
    <div class="filtro-group">
      <label>Buscar por Nombre:</label>
      <input type="text" [(ngModel)]="terminoBusquedaNombre" 
             placeholder="Ingrese nombre..." 
             (keyup.enter)="buscarPorNombre()">
      <button (click)="buscarPorNombre()">Buscar</button>
    </div>

    <!-- Búsqueda por cédula -->
    <div class="filtro-group">
      <label>Buscar por Cédula:</label>
      <input type="text" [(ngModel)]="terminoBusquedaCedula" 
             placeholder="Ingrese cédula..." 
             (keyup.enter)="buscarPorCedula()">
      <button (click)="buscarPorCedula()">Buscar</button>
    </div>

    <!-- Filtro por tipo de usuario -->
    <div class="filtro-group">
      <label>Filtrar por Tipo:</label>
      <select [(ngModel)]="tipoUsuarioFiltro" (change)="filtrarPorTipo()">
        <option *ngFor="let tipo of tiposUsuario" [value]="tipo.value">
          {{ tipo.label }}
        </option>
      </select>
    </div>
  </div>

  <div class="filtros-row">
    <!-- Filtro por fecha -->
    <div class="filtro-group">
      <label>Filtrar por Fecha:</label>
      <select [(ngModel)]="tipoFiltroFecha">
        <option value="">Seleccione tipo</option>
        <option value="rango">Por rango de fechas</option>
        <option value="despues">Creados después de</option>
        <option value="antes">Creados antes de</option>
      </select>
    </div>

    <div class="filtro-group fecha-group" *ngIf="tipoFiltroFecha === 'rango'">
      <label>Desde:</label>
      <input type="date" [(ngModel)]="fechaInicioFiltro">
      <label>Hasta:</label>
      <input type="date" [(ngModel)]="fechaFinFiltro">
      <button (click)="filtrarPorFecha()">Aplicar</button>
    </div>

    <div class="filtro-group fecha-group" *ngIf="tipoFiltroFecha === 'despues' || tipoFiltroFecha === 'antes'">
      <label>{{ tipoFiltroFecha === 'despues' ? 'Después de:' : 'Antes de:' }}</label>
      <input type="date" [(ngModel)]="fechaEspecificaFiltro">
      <button (click)="filtrarPorFecha()">Aplicar</button>
    </div>

    <!-- Botón para limpiar filtros -->
    <div class="filtro-group">
      <button (click)="limpiarFiltros()" class="btn-limpiar">Limpiar Filtros</button>
    </div>
  </div>
</div>

  
  <div class="tabla-container">
  <h3>Usuarios Registrados</h3>
  <div class="tabla-scroll">
    <table class="tabla-usuarios">
      <thead>
        <tr>
          <th>ID</th>
          <th>Cédula</th>
          <th>Nombre</th>
          <th>Usuario</th>
          <th>Correo</th>
          <th>Tipo</th>
          <th>Estado</th>
          <th>Fecha Creación</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let u of usuarios">
          <td>{{ u.id }}</td>
          <td>{{ u.cedula }}</td>
          <td>{{ u.nombre }}</td>
          <td>{{ u.nombreUsuario }}</td>
          <td>{{ u.correo }}</td>
          <td><span class="badge-tipo">{{ u.tipoUsuario }}</span></td>
          <td>
            <span [class.estado-activo]="u.estado" [class.estado-inactivo]="!u.estado">
              {{ u.estado ? 'Activo' : 'Inactivo' }}
            </span>
          </td>
          <td>{{ u.fechaCreacion | date:'short' }}</td>
          <td>
            <div class="acciones-usuario">
              <button (click)="editarUsuario(u)" title="Editar usuario">
                <i class="fas fa-edit"></i>
              </button>
              <button (click)="cambiarEstadoUsuario(u)" [class]="u.estado ? 'btn-desactivar' : 'btn-activar'" 
                      [title]="u.estado ? 'Desactivar usuario' : 'Activar usuario'">
                <i [class]="u.estado ? 'fas fa-user-slash' : 'fas fa-user-check'"></i>
              </button>
              <!-- Botón para eliminar usuario -->
              <button (click)="eliminarUsuario(u)" class="btn-eliminar" title="Eliminar usuario permanentemente">
                <i class="fas fa-trash-alt"></i>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <p *ngIf="usuarios.length === 0" class="sin-registros">No hay usuarios registrados</p>
</div>
</div>

    <div *ngIf="seccionActiva === 'productos'">
  <h2>Crear Producto</h2>
  <form (ngSubmit)="guardarProducto()" #formProducto="ngForm">
    <div class="form-group">
      <input type="text" placeholder="Nombre" [(ngModel)]="nuevoProducto.nombre" name="nombre" required />
    </div>
    <div class="form-group">
      <input type="text" placeholder="Código" [(ngModel)]="nuevoProducto.codigo" name="codigo" required />
    </div>
    <div class="form-group">
      <textarea placeholder="Descripción" [(ngModel)]="nuevoProducto.descripcion" name="descripcion"></textarea>
    </div>
    <div class="form-group">
      <input type="text" placeholder="Categoría" [(ngModel)]="nuevoProducto.categoria" name="categoria" required />
    </div>
    <div class="form-group">
      <input type="number" placeholder="Precio" step="0.01" [(ngModel)]="nuevoProducto.precio" name="precio" required />
    </div>
    <div class="form-group">
      <input type="number" placeholder="Stock" [(ngModel)]="nuevoProducto.stock" name="stock" required />
    </div>
    <div class="form-group">
      <input type="text" placeholder="URL de Imagen" [(ngModel)]="nuevoProducto.imagen" name="imagen" />
    </div>
    <div class="form-group button-group">
      <button type="submit">Guardar</button>
    </div>
  </form>

      <div class="tabla-productos-scroll">
        <table class="tabla-productos">
          <thead>
            <tr>
              <th>ID</th>
              <th>Nombre</th>
              <th>Código</th>
              <th>Categoría</th>
              <th>Precio</th>
              <th>Stock</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let producto of productos">
              <td>{{ producto.id }}</td>
              <td>{{ producto.nombre }}</td>
              <td>{{ producto.codigo }}</td>
              <td>{{ producto.categoria }}</td>
              <td>{{ producto.precio }}</td>
              <td>{{ producto.stock }}</td>
              <td>
                <div class="acciones-producto">
                  <button (click)="editarProducto(producto)">Editar</button>
                  <button (click)="eliminarProducto(producto)">Eliminar</button>
                  <button (click)="verDetallesProducto(producto)">Ver Detalles</button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

<div *ngIf="seccionActiva === 'ordenes'">
  <h2>Órdenes de Venta</h2>
  
  <!-- Botones de filtrado -->
  <div class="filtros-ordenes">
    <button (click)="filtrarOrdenes('fecha')">Listar órdenes por fecha</button>
    <button (click)="filtrarOrdenes('valor')">Listar órdenes por valor</button>
    <button (click)="filtrarOrdenes('pagadas')">Listar órdenes pagadas</button>
    <button (click)="filtrarOrdenes('pendientes')">Listar órdenes pendientes</button>
    <button (click)="filtrarOrdenes('despachadas')">Listar órdenes despachadas</button>
    <button (click)="filtrarOrdenes('cerradas')">Listar órdenes cerradas</button>
  </div>
  
  <input type="text" placeholder="Buscar orden..." [(ngModel)]="terminoBusqueda" (input)="filtrarOrdenes()" />
  
  <table class="tabla-ordenes">
    <thead>
      <tr>
        <th>N° Orden</th>
        <th>Cliente</th>
        <th>Fecha</th>
        <th>Total</th>
        <th>Estado</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let orden of ordenesFiltradas">
        <td>{{ orden.id }}</td>
        <td>{{ orden.cliente.nombre }}</td>
        <td>{{ orden.fecha | date: 'shortDate' }}</td>
        <td>{{ orden.total | currency:'USD' }}</td>
        <td>{{ orden.estado }}</td>
        <td>
          <button (click)="verDetallesOrden(orden)">Ver Detalles</button>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<div *ngIf="seccionActiva === 'reportes'" class="reportes-container">
  <h2>Reportes y Estadísticas</h2>
  <div class="form-group botones-reportes">
    <button class="btn-reporte" type="button" (click)="cargarReportePorVendedor()">Generar Reporte por Vendedor</button>
  </div>

      <table class="tabla-reportes" *ngIf="reportesPorVendedor.length > 0">
        <thead>
          <tr>
            <th>ID del Vendedor</th>
            <th>Nombre del Vendedor</th>
            <th>Correo</th>
            <th>Telefono</th>
            <th>Total de Ventas</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let reporte of reportesPorVendedor">
            <td>{{ reporte.vendedorDTO.id }}</td>
            <td>{{ reporte.vendedorDTO.nombre }}</td>
            <td>{{ reporte.vendedorDTO.correo }}</td>
            <td>{{ reporte.vendedorDTO.telefono }}</td>
            <td>{{ reporte.totalVentas | number:'1.2-2' }}</td>

          </tr>
                   
        </tbody>
      </table>
    
      <p *ngIf="reportesPorVendedor.length === 0">No hay datos de reporte por vendedor disponibles.</p>
    </div>
   

    <div *ngIf="seccionActiva === 'inventario'">
  <h2>Inventario</h2>
  <input type="text" placeholder="Buscar producto..." />

  <table class="tabla-inventario">
    <thead>
      <tr>
        <th>Producto</th>
        <th>Código</th>
        <th>Stock</th>
        <th>Categoría</th>
        <th>Cantidad Ventas</th>
        <th>Valor Ventas</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let item of productosReporte">
  <td>{{ item.producto.nombre || 'Sin nombre' }}</td>
<td>{{ item.producto.codigo || 'Sin código' }}</td>
<td>{{ item.producto.stock}}</td>
<td>{{ item.producto.categoria.nombre || 'Sin categoría' }}</td>
<td>{{ item.cantidadVentas}}</td>
<td>{{ item.valorVentas}}</td>

  <td>
    <button>Ver</button>
      </td>
    </tr>
    </tbody>
  </table>
</div>


    <div *ngIf="seccionActiva === 'configuracion'" class="configuracion-container">
      <h2>Configuración del Sistema</h2>
      <form>
        <div class="form-group">
          <label>Nombre de la Tienda</label>
          <input type="text" placeholder="Ej. TodoTech Shop" required />
        </div>
        <div class="form-group">
          <label>Logo (URL)</label>
          <input type="text" placeholder="https://example.com/logo.png" />
        </div>
        <div class="form-group">
          <label>Tasa de Impuesto (IVA %)</label>
          <input type="number" placeholder="Ej. 19" step="0.01" />
        </div>
        <div class="form-group">
          <label>Moneda por Defecto</label>
          <select required>
            <option value="COP">Peso Colombiano (COP)</option>
            <option value="USD">Dólar (USD)</option>
            <option value="EUR">Euro (EUR)</option>
          </select>
        </div>
        <div class="form-group">
          <label>Mantenimiento</label>
          <select>
            <option value="false">Desactivado</option>
            <option value="true">Activado</option>
          </select>
        </div>
        <div class="form-group button-group">
          <button type="submit">Guardar Cambios</button>
        </div>
      </form>

      <table class="tabla-configuracion">
        <thead>
          <tr>
            <th>Parámetro</th>
            <th>Valor Actual</th>
            <th>Última Modificación</th>
          </tr>
        </thead>
        <tbody>
          <!-- Configuración registrada -->
        </tbody>
      </table>
    </div>
  </section>
</main>

</body>
</html>